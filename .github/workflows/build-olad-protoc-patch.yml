name: Build Patches for OLAD
on:
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout repo
            uses: actions/checkout@v4
        
          - name: Generate OLA patches
            run: |
              # 1. Download OLA source tarball
              wget https://github.com/OpenLightingProject/ola/releases/download/0.10.8/ola-0.10.8.tar.gz

              # 2. Extract only config/ola.m4 from tarball
              mkdir -p original_ola
              tar -xzf ola-0.10.8.tar.gz -C original_ola

              # 3. Ensure patch directory exists
              mkdir -p package/olad

              # 4. Create unified diff between original and your modified version
              diff -u \
                original_ola/ola-0.10.8/config/ola.m4 \
                package/olad/patches/ola.m4 \
                > package/olad/0001-auto-generated.patch || true
              diff -u \
                original_ola/ola-0.10.8/protoc/Makefile.mk \
                package/olad/patches/Makefile.mk \
                > package/olad/0002-fix-protoc-makefile.patch || true

              diff -u \
                original_ola/ola-0.10.8/common/protocol/Makefile.mk \
                package/olad/patches/protocol/Makefile.mk \
                > package/olad/0003-fix-protoc-use.patch || true

              diff -u \
                original_ola/ola-0.10.8/common/rpc/Makefile.mk \
                package/olad/patches/rpc/Makefile.mk \
                > package/olad/0004-fix-protoc-use-rpc.patch || true

              diff -u 
                original_ola/ola-0.10.8/common/rdm/Makefile.mk 
                package/olad/patches/rdm/Makefile.mk 
                > package/olad/0006-fix-protoc-use-rdm.patch || true

              echo "VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV PATCH OUTPUT (ola.m4) VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"
              cat package/olad/0001-auto-generated.patch
              echo "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA PATCH OUTPUT (ola.m4) AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
              echo "VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV PATCH OUTPUT (protoc/Makefile.mk) VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"
              cat package/olad/0002-fix-protoc-makefile.patch
              echo "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA PATCH OUTPUT (protoc/Makefile.mk) AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
              echo "VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV PATCH OUTPUT (protocol/Makefile.mk) VVVVVVVVVVVVVVVVVVVVVVVVVVVVV"
              cat package/olad/0003-fix-protoc-use.patch
              echo "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA PATCH OUTPUT (protocol/Makefile.mk) AAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
              echo "VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV PATCH OUTPUT (rpc/Makefile.mk) VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"
              cat package/olad/0004-fix-protoc-use-rpc.patch
              echo "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA PATCH OUTPUT (rpc/Makefile.mk) AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
              echo "VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV PATCH OUTPUT (rdm/Makefile.mk) VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"
              cat package/olad/0004-fix-protoc-use-rdm.patch
              echo "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA PATCH OUTPUT (rdm/Makefile.mk) AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"

          - name: Information
            run: |
              echo "Patch needs to be copied into package/olad as f.ex. 0001-patchname.patch. Also you need to change the paths in the first lines to '--- a/config/ola.m4' and '+++ b/config/ola.m4'"
