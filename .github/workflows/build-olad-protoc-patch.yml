name: Build Patches for OLAD
on:
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout repo
            uses: actions/checkout@v4
        
          - name: Generate OLA patches
            run: |
              # 1. Download OLA source tarball
              wget https://github.com/OpenLightingProject/ola/releases/download/0.10.8/ola-0.10.8.tar.gz

              # 2. Extract only config/ola.m4 from tarball
              mkdir -p original_ola
              tar -xzf ola-0.10.8.tar.gz -C original_ola

              # 3. Ensure patch directory exists
              mkdir -p package/olad

              # 4. Create unified diff between original and your modified version
              diff -u \
                original_ola/ola-0.10.8/config/ola.m4 \
                package/olad/patches/ola.m4 \
                > package/olad/0001-auto-generated.patch || true
              diff -u \
                original_ola/ola-0.10.8/protoc/Makefile.mk \
                package/olad/patches/Makefile.mk \
                > package/olad/0002-fix-protoc-makefile.patch || true

              echo "VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV PATCH OUTPUT (ola.m4) VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"
              cat package/olad/0001-auto-generated.patch
              echo "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA PATCH OUTPUT (ola.m4) AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
              echo "VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV PATCH OUTPUT (Makefile.mk) VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"
              cat package/olad/0002-fix-protoc-makefile.patch
              echo "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA PATCH OUTPUT (Makefile.mk) AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"

          - name: Information
            run: |
              echo "Patch needs to be copied into package/olad as f.ex. 0001-patchname.patch. Also you need to change the paths in the first lines to '--- a/config/ola.m4' and '+++ b/config/ola.m4'"
